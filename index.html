<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
        <!--<style>
            .container {
                width: 1000px;
            }
        </style>-->

        <title>web game</title>
    </head>

    <body>
        <nav class="navbar navbar-light bg-light">
            <div class="container d-flex">
                <span class="navbar-brand mb-0 h1"><i class="bi bi-controller"></i> Team 19</span>
                <span class="fs-4" id="reset"><i class="bi bi-arrow-repeat"></i></span>
            </div>
        </nav>
    
        <div class="container">

            <div id="stages" class="d-flex pt-5 my-5">
            </div>

            <div id="message"></div>
        </div>

        <!-- Option 1: Bootstrap Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

        <script>
            //진행상황 불러오기
            let last_stage = Number(window.localStorage.getItem("last_stage"))
            if (last_stage === null) {
                last_stage = 0
            }
            
            let stages = document.querySelector("#stages")
            //오픈된 스테이지 생성
            for (let i=0; i<=last_stage && i<4; i++) {
                let new_stage = document.createElement("div")
                new_stage.classList.add("flex-grow-1", "shadow", "bg-success", "rounded-2", "py-5", "mx-2", "justify-content-between")
                new_stage.id = "l" + (i+1)

                let level = document.createElement("h3")
                level.classList.add("text-center", "text-white", "my-1")
                level.textContent = "Level" + (i+1)

                new_stage.appendChild(level)
                stages.appendChild(new_stage)
            }
            //닫힌 스테이지 생성
            for (let i=0; i<3-last_stage; i++) {
                let new_stage = document.createElement("div")
                new_stage.classList.add("flex-grow-1", "shadow", "bg-secondary", "rounded-2", "py-5", "mx-2")
                
                let level = document.createElement("h3")
                level.classList.add("text-center", "my-1")
                level.textContent = "Level" + (i+2+last_stage)

                new_stage.appendChild(level)
                stages.appendChild(new_stage)
            }

            //최종 축하 메시지
            let message_box = document.querySelector("#message")
            let message = document.createElement("h1")
            if (last_stage >= 4) {
                message.textContent = "Congratulation! You completed all stages!"
            }
            message_box.appendChild(message)
            
            let one = document.querySelector("#l1")
            one.addEventListener("click", () => {
                window.localStorage.setItem("current_stage", 1)
                location.href="battle.html"
            })

            let two = document.querySelector("#l2")
            if (two !== null) {
                two.addEventListener("click", () => {
                window.localStorage.setItem("current_stage", 2)
                location.href="battle.html"
            })}

            let three = document.querySelector("#l3")
            if (three !== null) {
                three.addEventListener("click", () => {
                window.localStorage.setItem("current_stage", 3)
                location.href="battle.html"
            })}

            let four = document.querySelector("#l4")
            if (four !== null) {
                four.addEventListener("click", () => {
                window.localStorage.setItem("current_stage", 4)
                location.href="battle.html"
            })}

            //리셋버튼
            let reset = document.querySelector("#reset")
            reset.addEventListener("click", () => {
                last_stage = 0
                window.localStorage.setItem("last_stage", last_stage)
                location.reload()
            })
        </script>
    
    </body>
</html>